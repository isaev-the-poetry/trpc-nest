# tRPC NestJS Decorators

üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ NestJS –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è tRPC —Ä–æ—É—Ç–µ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤.

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç npm –ø–∞–∫–µ—Ç `trpc-nest-decorators`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å tRPC –≤ NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã. –ü–∞–∫–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ–±—ã—á–Ω—ã—Ö NestJS –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –≤ tRPC —Ä–æ—É—Ç–µ—Ä—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
trpc-nest-decorators/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ trpc-nest-decorators/    # –û—Å–Ω–æ–≤–Ω–æ–π npm –ø–∞–∫–µ—Ç
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ decorators.ts     # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (@Router, @Query, @Mutation)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ trpc-router.service.ts  # –°–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ tRPC —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auto-router.service.ts  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–µ—Ä
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ trpc-nest.module.ts     # NestJS –º–æ–¥—É–ª—å
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main-router.ts    # –£—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ index.ts          # –≠–∫—Å–ø–æ—Ä—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ API
‚îÇ       ‚îú‚îÄ‚îÄ package.json
‚îÇ       ‚îú‚îÄ‚îÄ tsconfig.json
‚îÇ       ‚îî‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ example/                     # –¢–µ—Å—Ç–æ–≤–æ–µ NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ users/               # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îÇ   ‚îú‚îÄ‚îÄ posts/               # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø–æ—Å—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ app.controller.ts    # –î–µ–º–æ endpoints
    ‚îÇ   ‚îú‚îÄ‚îÄ app.service.ts       # –°–µ—Ä–≤–∏—Å —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–æ—É—Ç–µ—Ä–æ–º
    ‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts        # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
    ‚îÇ   ‚îî‚îÄ‚îÄ main.ts              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
    ‚îú‚îÄ‚îÄ package.json
    ‚îî‚îÄ‚îÄ README.md
```

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–∞

### ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **–ö–æ—Ä–æ—Ç–∫–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã**: `@Router`, `@Query`, `@Mutation`, `@Subscription`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤**: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ NestJS –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –≤ tRPC —Ä–æ—É—Ç–µ—Ä—ã
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä**: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –≤ –æ–¥–∏–Ω —Ä–æ—É—Ç–µ—Ä
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zod –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Dependency Injection**: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ DI —Å–∏—Å—Ç–µ–º—ã NestJS
- **TypeScript –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: —Å—Ç–∞—Ä—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `Trpc` –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –∑–Ω–∞–∫–æ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ NestJS
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**: –ª–µ–≥–∫–æ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ–µ–∫—Ç–∞–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ä–æ—É—Ç–µ—Ä—ã
- **–ì–∏–±–∫–æ—Å—Ç—å**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ NestJS –∏ tRPC
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞

```bash
cd packages/trpc-nest-decorators
npm install
npm run build
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞

```bash
cd example
npm install
npm run build
npm start
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- http://localhost:3000/api - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- http://localhost:3000/api/trpc-schema - —Å—Ö–µ–º–∞ tRPC —Ä–æ—É—Ç–µ—Ä–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install trpc-nest-decorators @trpc/server zod
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

```typescript
import { Injectable } from '@nestjs/common';
import { Router, Query, Mutation } from 'trpc-nest-decorators';
import { z } from 'zod';

@Router({ prefix: 'users' })
@Injectable()
export class UsersController {
  @Query('getAll')
  async getAllUsers() {
    return [{ id: 1, name: 'John' }];
  }

  @Mutation('create', {
    input: z.object({ name: z.string().min(1) })
  })
  async createUser(input: { name: string }) {
    return { id: Date.now(), name: input.name };
  }
}
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è

```typescript
import { Module } from '@nestjs/common';
import { TrpcNestModule } from 'trpc-nest-decorators';

@Module({
  imports: [TrpcNestModule.forRoot()],
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
})
export class AppModule {}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–µ—Ä

```typescript
import { Injectable } from '@nestjs/common';
import { createMainRouter, AutoRouterService } from 'trpc-nest-decorators';

@Injectable()
export class AppService {
  constructor(
    private readonly autoRouterService: AutoRouterService,
    private readonly usersController: UsersController
  ) {
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
    this.autoRouterService.registerController(UsersController, this.usersController);
  }

  getTrpcRouter() {
    // –ü–æ–ª—É—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
    return createMainRouter();
  }
}
```

## –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã

### `@Router(options?)`
–ü–æ–º–µ—á–∞–µ—Ç –∫–ª–∞—Å—Å –∫–∞–∫ tRPC —Ä–æ—É—Ç–µ—Ä
- `options.prefix` - –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

### `@Query(path?, options?)`
–°–æ–∑–¥–∞–µ—Ç tRPC query –ø—Ä–æ—Ü–µ–¥—É—Ä—É
- `path` - –ø—É—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `options.input` - —Å—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `options.output` - —Å—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### `@Mutation(path?, options?)`
–°–æ–∑–¥–∞–µ—Ç tRPC mutation –ø—Ä–æ—Ü–µ–¥—É—Ä—É

### `@Subscription(path?, options?)`
–°–æ–∑–¥–∞–µ—Ç tRPC subscription –ø—Ä–æ—Ü–µ–¥—É—Ä—É

## –£—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### `createMainRouter()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≥–ª–∞–≤–Ω—ã–π tRPC —Ä–æ—É—Ç–µ—Ä

### `getRegisteredControllers()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

## –ü—Ä–∏–º–µ—Ä—ã

–í –ø–∞–ø–∫–µ `example/` –≤—ã –Ω–∞–π–¥–µ—Ç–µ –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä —Å:
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ—Å—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- –†–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ tRPC –ø—Ä–æ—Ü–µ–¥—É—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –≥–ª–∞–≤–Ω–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞
- –ü–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å NestJS DI

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°—Ç–∞—Ä—ã–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `Trpc` –≤—Å–µ –µ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:

```typescript
// –°—Ç–∞—Ä—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (–≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
import { TrpcRouter, TrpcQuery, TrpcMutation } from 'trpc-nest-decorators';

// –ù–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
import { Router, Query, Mutation } from 'trpc-nest-decorators';
```

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [x] –ö–æ—Ä–æ—Ç–∫–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
- [ ] HTTP adapter –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Middleware –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [ ] –¢–µ—Å—Ç—ã

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ú—ã —Ä–∞–¥—ã –≤–∞—à–µ–º—É —É—á–∞—Å—Ç–∏—é! –°–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –∏ pull requests.

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –ø–∞–∫–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞. 